<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>esm.sh run demo</title>
    <meta
      http-equiv="Content-Security-Policy"
      content="style-src 'self' 'unsafe-inline' https://rsms.me/; font-src 'self' https://rsms.me/; img-src 'self' https://cdn.esm.sh https://esm.sh; connect-src https://cdn.esm.sh https://esm.sh https://rsms.me; default-src 'self'; object-src 'none'; base-uri 'none'; script-src 'strict-dynamic' 'sha384-DQW8zrmFneSMurt9zWQfr3S8jjIlse9SGyWdd2OZbTTNzeaudphHQPsevhyUXEXJ' 'sha384-k5kG7BLu6yiXonqb4+mLydLx97KjzEYs3A6XPKVmzRHIXwzao+ucAMeaSPLZcBI8' 'self' https://esm.sh data:"
    />
    <link rel="preconnect" href="https://esm.sh/" />
    <link rel="preconnect" href="https://rsms.me/" />
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
    <script type="text/javascript">
      const importmap = document.createElement('script')
      importmap.type = 'importmap'
      importmap.textContent = JSON.stringify({
        imports: {
          '@jsxImportSource': 'https://esm.sh/react',
          ...Object.fromEntries(
            ['react', 'react-dom/client', 'styled-components'].map((pkg) => [
              pkg,
              `https://esm.sh/${pkg}`,
            ]),
          ),
        },
      })

      const loader = document.createElement('script')
      loader.type = 'module'
      loader.src = 'https://esm.sh/run'
      loader.defer = true

      document.currentScript.after(importmap)
      document.currentScript.after(loader)
    </script>
  </head>

  <body>
    <div id="root"><p>Loading ...</p></div>
    <script type="text/babel">
      import { createRoot } from 'react-dom/client'
      import styled, { css } from 'styled-components'

      const fonts = css`
          font-family: Inter, Helvetica Neue, system-ui, -apple-system,
            BlinkMacSystemFont, Segoe UI, Roboto, Oxygen, Ubuntu, Cantarell, Open Sans,
            sans-serif;
        `

      const Heading = styled.h1`
          ${fonts}
        `
      const Paragraph = styled.p`
          ${fonts}
        `

      const Image = styled.img`
          height: auto;
          max-width: 768px;

          @media screen and (max-width: 768px) {
            width: 100%;
          }
        `

      const RE_ESM_SH =
        /^https:\/\/esm\.sh\/[^/]+\/(?<identifier>(?:@[^/]+\/)?[^/]+@[^/]+)\/.+$/

      /**
       * @typedef {Object} ResolveStaticOptions
       * @property {string} name
       * @property {string | undefined} base
       * @property {() => string} fallback
       *
       * @param {ResolveStaticOptions} options
       * @returns {string | undefined}
       */
      function resolveStatic({ name, base, fallback }) {
        if (base) {
          const match = RE_ESM_SH.exec(base)
          if (match) {
            const { identifier } = match.groups
            return new URL(name, `https://cdn.esm.sh/${identifier}/`).href
          }
        }
        try {
          return fallback()
        } catch (e) {
          return undefined
        }
      }

      function App() {
        return (
          <>
            <Heading>Shinjuku, Tokyo</Heading>
            <Image
              src={resolveStatic({
                name: "assets/shinjuku.jpg",
                base: import.meta.url,
                fallback: () =>
                  new URL("../assets/shinjuku.jpg", import.meta.url).href,
              })}
            />
            <Paragraph>
              Â©{" "}
              <a
                href="https://commons.wikimedia.org/wiki/File:Skyscrapers_of_Shinjuku_2009_January_(revised).jpg"
                target="_blank"
              >
                Morio, via Wikimedia Commons, CC BY-SA 3.0
              </a>
            </Paragraph>
            <Paragraph>
              Powered by{" "}
              <a
                href="https://github.com/esm-dev/esm.sh/releases/tag/v135"
                target="_blank"
              >
                esm.sh/run
              </a>
            </Paragraph>
          </>
        );
      }

      createRoot(document.getElementById('root')).render(<App />)
    </script>
  </body>
</html>
